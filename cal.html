<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>生鸡蛋杯计算器 Ver1.0</title>
  <style>
    :root {
      --bg: #f4f6f8;
      --card: #ffffff;
      --muted: #6b7280;
      --text: #111827;
      --line: #d1d5db;
      --primary: #0f766e;
      --primary-strong: #115e59;
      --accent: #dc2626;
      --soft: #ecfeff;
      --shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      --font-ui: "HarmonyOS Sans SC", "MiSans", "Noto Sans SC", "PingFang SC", "Microsoft YaHei UI", "Microsoft YaHei", sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 24px;
      font-family: var(--font-ui);
      font-size: 15px;
      line-height: 1.45;
      color: var(--text);
      background:
        radial-gradient(circle at 8% 5%, #dbeafe 0%, transparent 28%),
        radial-gradient(circle at 95% 90%, #ccfbf1 0%, transparent 24%),
        var(--bg);
    }

    .app {
      max-width: 1320px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.84);
      backdrop-filter: blur(2px);
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      background: linear-gradient(120deg, #0f766e, #14b8a6);
      color: #fff;
    }

    .title {
      font-size: 24px;
      font-weight: 800;
      letter-spacing: 0.3px;
    }

    .badge {
      font-size: 13px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.35);
      padding: 4px 10px;
      border-radius: 999px;
    }

    .content {
      display: grid;
      grid-template-columns: 1.2fr 1.2fr 1fr;
      gap: 16px;
      padding: 16px;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 14px;
    }

    .panel h3 {
      margin: 0 0 10px;
      font-size: 17px;
      font-weight: 700;
    }
    .section-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0 0 10px;
    }
    .section-head h3 {
      margin: 0;
    }
    .mini-summary {
      font-size: 12px;
      color: #0f766e;
      border: 1px solid #99f6e4;
      background: #f0fdfa;
      border-radius: 999px;
      padding: 2px 8px;
      white-space: nowrap;
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    .row.wrap { flex-wrap: wrap; }

    label {
      min-width: 68px;
      font-size: 15px;
      font-weight: 600;
      color: #374151;
    }

    input, select, button {
      font: inherit;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      min-height: 34px;
      font-size: 15px;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 6px 10px;
      background: #fff;
    }

    input:focus,
    select:focus {
      outline: 2px solid #99f6e4;
      border-color: var(--primary);
    }

    button {
      min-height: 32px;
      font-size: 14px;
      font-weight: 600;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      background: #f9fafb;
      padding: 4px 10px;
      cursor: pointer;
      transition: 0.15s ease;
    }

    button:hover { transform: translateY(-1px); }

    .btn-primary {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    .btn-primary:hover { background: var(--primary-strong); }

    .btn-danger {
      background: #fee2e2;
      border-color: #fecaca;
      color: #991b1b;
    }

    .mini {
      min-width: 34px;
      padding: 0;
    }

    .count {
      min-width: 30px;
      text-align: center;
      font-weight: 700;
      color: var(--primary-strong);
    }
    .counter-row {
      display: grid;
      grid-template-columns: minmax(96px, 1fr) 42px 42px 44px 56px;
      gap: 6px;
      align-items: center;
      margin-bottom: 8px;
    }
    .counter-name {
      font-size: 15px;
      font-weight: 600;
      color: #374151;
      white-space: nowrap;
    }
    .counter-row .hint {
      text-align: center;
      font-size: 12px;
    }

    .btn-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border: 1px solid #d1fae5;
      border-radius: 999px;
      background: #ecfdf5;
      font-size: 13px;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      margin: 8px 0;
    }

    .stat {
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 8px;
      background: #fafafa;
      text-align: center;
    }

    .stat b {
      display: block;
      font-size: 18px;
      color: var(--primary-strong);
    }

    .table-wrap {
      border: 1px solid var(--line);
      border-radius: 10px;
      overflow: auto;
      max-height: 420px;
      background: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th, td {
      border-bottom: 1px solid #f1f5f9;
      padding: 8px;
      text-align: left;
    }

    th {
      position: sticky;
      top: 0;
      background: #f8fafc;
      z-index: 1;
    }

    tr.selected { background: #ecfeff; }

    .footer {
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      background: var(--soft);
      border: 1px solid #bae6fd;
    }

    .formula {
      color: var(--accent);
      font-size: 13px;
      margin-top: 6px;
    }

    .hint {
      color: var(--muted);
      font-size: 12px;
    }

    @media (max-width: 1080px) {
      .content { grid-template-columns: 1fr; }
      .stats { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="title">生鸡蛋杯计算器 Ver1.0</div>
      <div class="badge">依据《生鸡蛋杯#4规则草案4.0》</div>
    </div>

    <div class="content">
      <section class="panel">
        <h3>基础信息</h3>
        <div class="row">
          <label for="school">小队名</label>
          <input id="school" type="text" placeholder="输入小队名" />
        </div>
        <div class="row">
          <label for="player">选手</label>
          <input id="player" type="text" placeholder="输入选手名" />
        </div>
        <div class="row">
          <label for="group">开局分队</label>
          <input id="group" type="text" placeholder="请输入开局分队" />
        </div>
        <div class="row">
          <label for="difficulty">难度</label>
          <select id="difficulty">
            <option value="n15">n15</option>
            <option value="n16">n16</option>
            <option value="n17">n17</option>
            <option value="n18">n18</option>
          </select>
        </div>

        <div class="section-head">
          <h3>计数加分</h3>
        </div>
        <div id="counterWrap"></div>

      </section>

      <section class="panel">
        <div class="section-head">
          <h3>作战加分</h3>
        </div>
        <div class="row">
          <label for="bossSelect">Boss关卡</label>
          <select id="bossSelect"></select>
          <button id="addBoss" class="btn-primary">加入Boss关卡</button>
        </div>
        <div class="row">
          <label for="urgentSelect">紧急作战</label>
          <select id="urgentSelect"></select>
        </div>
        <div class="row">
          <label for="hiddenSelect">隐藏关卡</label>
          <select id="hiddenSelect"></select>
        </div>
        <div class="row wrap">
          <button id="addUrgent" class="btn-primary">加入紧急作战</button>
          <button id="addHidden" class="btn-primary">加入隐藏关卡</button>
        </div>

        <div class="section-head">
          <h3>额外参数</h3>
        </div>
        <div class="row">
          <label for="baseSettle">结算分数</label>
          <input id="baseSettle" type="number" value="0" />
        </div>
        <div class="row">
          <label for="ingotStart">开局源石锭</label>
          <input id="ingotStart" type="number" value="0" />
        </div>
        <div class="row">
          <label for="ingotEnd">结束源石锭</label>
          <input id="ingotEnd" type="number" value="0" />
        </div>
        <div class="hint" id="ingotDiffHint">取钱数：0（开始-结束）</div>
        <div class="row">
          <label for="extraBonus">额外加分</label>
          <input id="extraBonus" type="number" value="0" />
        </div>
        <div class="row">
          <label for="extraPenaltyA">额外扣分</label>
          <input id="extraPenaltyA" type="number" value="0" />
        </div>
      </section>

      <section class="panel">
        <div class="section-head">
          <h3>计分明细</h3>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width: 38px;">选择</th>
                <th>关卡名</th>
                <th>条件</th>
                <th style="width: 72px;">分数</th>
              </tr>
            </thead>
            <tbody id="detailBody"></tbody>
          </table>
        </div>

        <div class="row wrap" style="margin-top:8px;">
          <button id="selectAll">全选</button>
          <button id="deleteSelected" class="btn-danger">删除选中</button>
          <button id="undoBtn">撤回</button>
          <button id="clearAll">重置计分</button>
        </div>

        <div class="stats">
          <div class="stat">结算分数<b id="baseSettleStatA">0</b></div>
          <div class="stat">计数加分<b id="autoScore">0</b></div>
          <div class="stat">紧急隐藏<b id="stageScore">0</b></div>
          <div class="stat">boss分<b id="bossScoreStat">0</b></div>
        </div>

        <div class="footer">
          <div class="row wrap">
            <span class="chip">难度选择 n18 时最终 *1.05</span>
            <span class="chip"><input id="flagBuff" type="checkbox" /> 持有不息+不赦（最终 *1.1）</span>
          </div>
          <div>最终得分：<b id="finalScore" style="color:#b91c1c;font-size:32px;">0</b></div>
          <div class="formula">公式：(结算分数(输入) + 计数加分 + 紧急隐藏 + boss分 + 额外加分 - 额外扣分) * 倍率</div>
          <div class="hint">倍率 = (n18 ? 1.05 : 1) * (不息+不赦 ? 1.1 : 1)</div>
          <div class="hint">作者：风筝</div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const rules = {
      urgent: [
        { name: "紧急峥嵘战功", score: 30, condition: "第4层" },
        { name: "紧急赶场戏班", score: 30, condition: "第4层 / 仅n18+30", n18Only: true },
        { name: "紧急忍气不吞声", score: 40, condition: "第4层" },
        { name: "紧急暗箭难防", score: 20, condition: "第4层 / 仅n18+20", n18Only: true },
        { name: "紧急贪饵", score: 20, condition: "第4层 / 仅n18+20", n18Only: true },
        { name: "紧急邙山镇地方志", score: 50, condition: "第5层 / n18按70" },
        { name: "紧急不成烟火", score: 30, condition: "第5层 / n18按50" },
        { name: "紧急青山不语", score: 30, condition: "第5层" },
        { name: "紧急离域检查", score: 20, condition: "第5层 / n18按50" },
        { name: "紧急砺锋", score: 30, condition: "第5层 / n18按50" },
        { name: "紧急炎灼", score: 40, condition: "第6层" },
        { name: "紧急人镇", score: 40, condition: "第6层 / n18按50" },
        { name: "紧急越山海", score: 50, condition: "第6层 / 无漏按70" },
        { name: "紧急借力打力", score: 40, condition: "第6层" }
      ],
      hidden: [
        { name: "紧急源源不断", score: 20, condition: "无漏+20", noLeakOnly: true },
        { name: "劫罚", score: 15, urgentScore: 30, condition: "普通+15 / 紧急+30" },
        { name: "生百相", score: 30, condition: "无漏+30", noLeakOnly: true },
        { name: "硕果累累", score: 15, urgentScore: 30, condition: "普通+15 / 紧急+30" },
        { name: "以逸待劳", score: 30, condition: "固定+30" },
        { name: "硅基伥的宴席", score: 25, urgentScore: 50, condition: "普通+25 / 紧急+50" },
        { name: "彻底失控", score: 25, urgentScore: 50, condition: "普通+25 / 紧急+50" },
        { name: "作壁上观", score: 20, condition: "无漏+20", noLeakOnly: true },
        { name: "分明", score: 30, condition: "固定+30" }
      ],
      boss: [
        { name: "破岁阵祀", score: 20, condition: "五层BOSS" },
        { name: "昔字如烟", score: 20, noLeakScore: 40, condition: "五层BOSS" },
        { name: "天数将易", score: 20, condition: "五层BOSS" },
        { name: "往昔难忆", score: 40, noLeakScore: 50, condition: "五层BOSS" },
        { name: "昔字如烟（三结局前置）", score: 40, noLeakScore: 60, condition: "三结局前置" },
        { name: "谋岁者", score: 20, noLeakScore: 30, condition: "六层BOSS" },
        { name: "末狩", score: 20, condition: "六层BOSS" },
        { name: "定乾坤", score: 50, condition: "第7层BOSS" },
        { name: "止变-定本源（朔壳/妄躯）", score: 175, condition: "止变版本" },
        { name: "止变-役群兽（全家桶）", score: 200, condition: "止变版本" },
        { name: "止变-其余", score: 100, condition: "止变版本" }
      ],
      counters: [
        { key: "temp6", name: "六星临招", unit: 50 },
        { key: "temp5", name: "五星临招", unit: 20 },
        { key: "temp4", name: "四星临招", unit: 10 },
        { key: "shengzhao", name: "圣诏封神计数", mode: "tiered_50_30_20" },
        { key: "tree", name: "二三层树洞1火", unit: 10 },
        { key: "dog", name: "狗击杀", unit: 10 },
        { key: "bear", name: "熊击杀", unit: 10 },
        { key: "duck", name: "鸭击杀", unit: 10 },
        { key: "rat", name: "鼠击杀", unit: 10 },
        { key: "x8", name: "小八界击杀", unit: 10 }
      ]
    };

    const state = {
      counters: Object.fromEntries(rules.counters.map(c => [c.key, 0])),
      items: [],
      history: []
    };

    const el = id => document.getElementById(id);

    const urgentSelect = el("urgentSelect");
    const hiddenSelect = el("hiddenSelect");
    const bossSelect = el("bossSelect");
    const detailBody = el("detailBody");
    const counterWrap = el("counterWrap");
    const urgentOptions = [];
    const hiddenOptions = [];
    const bossOptions = [];

    function addItem(item, type) {
      state.items.push({
        id: `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,
        type,
        name: item.name,
        condition: item.condition,
        score: Number(item.score)
      });
      state.history.push({ op: "add" });
      render();
    }

    function updateCounter(key, delta) {
      state.counters[key] = Math.max(0, state.counters[key] + delta);
      render();
    }

    function getCountScore() {
      return rules.counters.reduce((sum, c) => {
        const count = state.counters[c.key];
        if (c.mode === "tiered_50_30_20") {
          if (count <= 0) return sum;
          if (count === 1) return sum + 50;
          return sum + 80 + (count - 2) * 20;
        }
        return sum + count * c.unit;
      }, 0);
    }

    function getStageScore() {
      return state.items
        .filter(i => i.type === "urgent" || i.type === "hidden")
        .reduce((s, i) => s + i.score, 0);
    }

    function getBossScore() {
      return state.items
        .filter(i => i.type === "boss")
        .reduce((s, i) => s + i.score, 0);
    }

    function getSettlementScore() {
      const baseSettle = Number(el("baseSettle").value || 0);
      return baseSettle + getCountScore() + getStageScore() + getBossScore();
    }

    function getFinalScore() {
      const settle = getSettlementScore();
      const add = Number(el("extraBonus").value || 0);
      const pa = Number(el("extraPenaltyA").value || 0);
      const isN18 = el("difficulty").value === "n18";

      let mul = 1;
      if (isN18) mul *= 1.05;
      if (el("flagBuff").checked) mul *= 1.1;

      const finalValue = (settle + add - pa) * mul;
      return Math.round(finalValue * 100) / 100;
    }

    function getOptionScore(item, type) {
      const isN18 = el("difficulty").value === "n18";
      let score = item.score;
      if (item.n18Only && !isN18) return 0;
      if (type === "urgent") {
        if (isN18 && item.name.includes("邙山镇地方志")) score = 70;
        if (isN18 && item.name.includes("不成烟火")) score = 50;
        if (isN18 && item.name.includes("离域检查")) score = 50;
        if (isN18 && item.name.includes("砺锋")) score = 50;
        if (isN18 && item.name.includes("人镇")) score = 50;
      }
      return score;
    }

    function refreshStageSelects() {
      const isN18 = el("difficulty").value === "n18";
      buildUrgentSelect(isN18);
      buildHiddenSelect();
      buildBossSelect();
    }

    function buildUrgentSelect(isN18) {
      urgentOptions.length = 0;
      rules.urgent.forEach(item => {
        if (item.n18Only && !isN18) return;
        const score = getOptionScore(item, "urgent");
        urgentOptions.push({
          name: item.name,
          score,
          condition: item.condition
        });
        if (item.name.includes("越山海")) {
          urgentOptions.push({
            name: `${item.name}（无漏）`,
            score: 70,
            condition: `${item.condition} / 无漏版本`
          });
        }
      });
      urgentSelect.innerHTML = "";
      urgentOptions.forEach((item, idx) => {
        const op = document.createElement("option");
        op.value = String(idx);
        op.textContent = `${item.name} (+${item.score})`;
        urgentSelect.appendChild(op);
      });
      if (!urgentSelect.options.length) {
        const op = document.createElement("option");
        op.value = "";
        op.textContent = "当前难度无可选项";
        urgentSelect.appendChild(op);
      }
    }

    function buildHiddenSelect() {
      hiddenOptions.length = 0;
      rules.hidden.forEach(item => {
        if (item.noLeakOnly) {
          hiddenOptions.push({
            name: `${item.name}（无漏）`,
            score: item.score,
            condition: `${item.condition} / 无漏版本`
          });
          return;
        }
        hiddenOptions.push({
          name: item.name,
          score: item.score,
          condition: `${item.condition} / 普通版本`
        });
        if (typeof item.urgentScore === "number") {
          hiddenOptions.push({
            name: `${item.name}（紧急）`,
            score: item.urgentScore,
            condition: `${item.condition} / 紧急版本`
          });
        }
      });
      hiddenSelect.innerHTML = "";
      hiddenOptions.forEach((item, idx) => {
        const op = document.createElement("option");
        op.value = String(idx);
        op.textContent = `${item.name} (+${item.score})`;
        hiddenSelect.appendChild(op);
      });
    }

    function buildBossSelect() {
      bossOptions.length = 0;
      rules.boss.forEach(item => {
        bossOptions.push({
          name: item.name,
          score: item.score,
          condition: item.condition
        });
        if (typeof item.noLeakScore === "number") {
          bossOptions.push({
            name: `${item.name}（无漏）`,
            score: item.noLeakScore,
            condition: `${item.condition} / 无漏版本`
          });
        }
      });
      bossSelect.innerHTML = "";
      bossOptions.forEach((item, idx) => {
        const op = document.createElement("option");
        op.value = String(idx);
        op.textContent = `${item.name} (+${item.score})`;
        bossSelect.appendChild(op);
      });
    }

    function renderCounters() {
      counterWrap.innerHTML = "";
      rules.counters.forEach(c => {
        const row = document.createElement("div");
        row.className = "counter-row";
        row.innerHTML = `
          <span class="counter-name">${c.name}</span>
          <button class="mini" data-k="${c.key}" data-d="1">+1</button>
          <button class="mini" data-k="${c.key}" data-d="-1">-1</button>
          <span class="count">${state.counters[c.key]}</span>
          <span class="hint">${c.mode === "tiered_50_30_20" ? "50/30/20" : `x ${c.unit}`}</span>
        `;
        counterWrap.appendChild(row);
      });
    }

    function renderTable() {
      detailBody.innerHTML = "";
      state.items.forEach(it => {
        const tr = document.createElement("tr");
        tr.dataset.id = it.id;
        tr.innerHTML = `
          <td><input type="checkbox" data-id="${it.id}" /></td>
          <td>${it.name}</td>
          <td>${it.condition}</td>
          <td>${it.score}</td>
        `;
        detailBody.appendChild(tr);
      });
    }

    function renderStats() {
      const bossItems = state.items.filter(i => i.type === "boss");
      const bossCount = bossItems.length;
      const bossScore = getBossScore();
      const battleCount = state.items.length;
      const stageScore = getStageScore();
      const countScore = getCountScore();
      const baseSettle = Number(el("baseSettle").value || 0);
      const settleScore = getSettlementScore();
      const finalScore = getFinalScore();
      const ingotStart = Number(el("ingotStart").value || 0);
      const ingotEnd = Number(el("ingotEnd").value || 0);
      const ingotDiff = ingotStart - ingotEnd;
      const add = Number(el("extraBonus").value || 0);
      const pa = Number(el("extraPenaltyA").value || 0);

      el("baseSettleStatA").textContent = String(baseSettle);
      el("autoScore").textContent = String(countScore);
      el("stageScore").textContent = String(stageScore);
      el("bossScoreStat").textContent = String(bossScore);
      if (el("settleScore")) el("settleScore").textContent = String(settleScore);
      el("finalScore").textContent = String(finalScore);
      el("ingotDiffHint").textContent = `取钱数：${ingotDiff}（开始-结束）`;
      if (el("bossSummary")) el("bossSummary").textContent = `${bossCount}条 / ${bossScore}分`;
      if (el("battleSummary")) el("battleSummary").textContent = `${battleCount}条 / ${stageScore + bossScore}分`;
      if (el("extraSummary")) el("extraSummary").textContent = `+${add} -${pa}`;
    }

    function render() {
      renderCounters();
      renderTable();
      renderStats();
      bindCounterButtons();
      bindRowHighlight();
    }

    function bindCounterButtons() {
      counterWrap.querySelectorAll("button[data-k]").forEach(btn => {
        btn.addEventListener("click", () => {
          updateCounter(btn.dataset.k, Number(btn.dataset.d));
        });
      });
    }

    function bindRowHighlight() {
      detailBody.querySelectorAll("input[type='checkbox']").forEach(cb => {
        cb.addEventListener("change", () => {
          cb.closest("tr").classList.toggle("selected", cb.checked);
        });
      });
    }

    function selectedIds() {
      return [...detailBody.querySelectorAll("input[type='checkbox']:checked")].map(x => x.dataset.id);
    }

    el("addUrgent").addEventListener("click", () => {
      if (urgentSelect.value === "") return;
      addItem(urgentOptions[Number(urgentSelect.value)], "urgent");
    });

    el("addHidden").addEventListener("click", () => {
      if (hiddenSelect.value === "") return;
      addItem(hiddenOptions[Number(hiddenSelect.value)], "hidden");
    });
    el("addBoss").addEventListener("click", () => {
      if (bossSelect.value === "") return;
      addItem(bossOptions[Number(bossSelect.value)], "boss");
    });

    el("selectAll").addEventListener("click", () => {
      detailBody.querySelectorAll("input[type='checkbox']").forEach(x => {
        x.checked = true;
        x.closest("tr").classList.add("selected");
      });
    });

    el("deleteSelected").addEventListener("click", () => {
      const ids = selectedIds();
      if (!ids.length) return;
      const removed = state.items.filter(i => ids.includes(i.id));
      state.items = state.items.filter(i => !ids.includes(i.id));
      state.history.push({ op: "delete", data: removed });
      render();
    });

    el("undoBtn").addEventListener("click", () => {
      const last = state.history.pop();
      if (!last) return;
      if (last.op === "add") {
        state.items.pop();
      } else if (last.op === "delete") {
        state.items.push(...last.data);
      }
      render();
    });

    el("clearAll").addEventListener("click", () => {
      state.items = [];
      Object.keys(state.counters).forEach(k => (state.counters[k] = 0));
      state.history = [];
      ["baseSettle", "extraBonus", "extraPenaltyA"].forEach(id => (el(id).value = 0));
      ["ingotStart", "ingotEnd"].forEach(id => (el(id).value = 0));
      el("difficulty").value = "n15";
      el("flagBuff").checked = false;
      render();
    });

    ["difficulty", "baseSettle", "ingotStart", "ingotEnd", "extraBonus", "extraPenaltyA", "flagBuff"]
      .forEach(id => el(id).addEventListener("input", render));

    el("difficulty").addEventListener("input", refreshStageSelects);
    refreshStageSelects();
    render();
  </script>
</body>
</html>
